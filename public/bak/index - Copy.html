<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Yearbook - 81 Highschool, Class of 2002</title>
    <style>
        :root {
            --primary: #3b5998;
            --secondary: #8b9dc3;
            --light: #f7f7f7;
            --dark: #333;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background-color: #f0f2f5;
        }
        header {
            background-color: var(--primary);
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .logo-container {
            display: flex;
            flex-direction: column;
        }
        .logo {
            font-size: 24px;
            font-weight: bold;
            letter-spacing: 1px;
        }
        .logo-subtitle {
            font-size: 14px;
            opacity: 0.9;
        }
        .nav-menu {
            display: flex;
            gap: 20px;
        }
        .nav-menu a {
            color: white;
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        .nav-menu a:hover {
            background-color: rgba(255,255,255,0.1);
        }
        .nav-menu a.active {
            background-color: rgba(255,255,255,0.2);
            font-weight: 500;
        }
        .search-bar {
            display: flex;
            padding: 8px;
            background: white;
            border-radius: 20px;
            margin: 0 20px;
        }
        .search-bar input {
            border: none;
            outline: none;
            padding: 0 10px;
            width: 200px;
        }
        .user-menu {
            display: flex;
            align-items: center;
        }
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #ddd;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .user-avatar:hover {
            transform: scale(1.1);
        }
        
        main {
            max-width: 800px;
            margin: 20px auto;
            padding: 0 20px;
        }
        
        .page-title {
            margin: 20px 0;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
            color: var(--dark);
            font-size: 24px;
        }
        
        .memory-feed {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .memory-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .memory-card-title {
            padding: 15px 15px 0;
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            text-align: center;
        }

        .memory-card-subtitle {
            padding: 0 15px 15px;
            font-size: 16px;
            color: #65676b;
            border-bottom: 1px solid #eee;
            text-align: center;
        }
        
        .memory-header {
            display: flex;
            align-items: center;
            padding: 15px;
        }
        
        .memory-author-pic {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #ddd;
            margin-right: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: #555;
        }
        
        .memory-meta {
            flex: 1;
        }
        
        .memory-author {
            font-weight: bold;
            color: var(--dark);
            font-size: 16px;
            margin-bottom: 4px;
        }
        
        .memory-context {
            color: #65676b;
            font-size: 14px;
        }
        
        .memory-context a {
            color: var(--primary);
            text-decoration: none;
        }
        
        .memory-content {
            padding: 0 15px 15px;
            color: var(--dark);
            font-size: 15px;
            line-height: 1.5;
        }
        
        .memory-image {
            width: 100%;
            height: auto;
            max-height: 500px;
            object-fit: contain;
            background-color: #f0f2f5;
            margin-bottom: 15px;
            cursor: pointer;
            transition: opacity 0.3s;
        }
        
        .memory-image:hover {
            opacity: 0.9;
        }
        
        .memory-actions {
            display: flex;
            padding: 10px 15px;
            border-top: 1px solid #eee;
        }
        
        .memory-action {
            display: flex;
            align-items: center;
            margin-right: 20px;
            cursor: pointer;
            color: #65676b;
            font-size: 14px;
            padding: 8px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .memory-action:hover {
            background-color: #f0f2f5;
        }
        
        .memory-action.liked {
            color: #e41e3f;
        }
        
        .add-memory-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: transform 0.2s;
            z-index: 100;
        }
        
        .add-memory-btn:hover {
            transform: scale(1.1);
        }
        
        @media (max-width: 768px) {
            .search-bar {
                display: none;
            }
            .memory-header {
                padding: 10px;
            }
            .memory-author-pic {
                width: 40px;
                height: 40px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo-container">
            <div class="logo">Digital Yearbook</div>
            <div class="logo-subtitle">81 Highschool, Class of 2002</div>
        </div>
        <div class="search-bar">
            <input type="text" placeholder="Search memories...">
        </div>
        <div class="nav-menu">
            <a href="index.html" class="active">Home</a>
            <a href="photos-section.html">Photos</a>
            <a href="Directory Section.html">Directory</a>
        </div>
        <div class="user-menu">
            <div class="user-avatar" title="Your Profile">
                <span>JD</span>
            </div>
        </div>
    </header>

    <main>
        <h1 class="page-title">Memory Feed</h1>
        
        <div class="memory-feed" id="memoryFeed">
            <!-- Featured memories will be loaded here -->
            <div class="memory-card">
                <div class="memory-card-title">Featured Memory of the Day</div>
                <div class="memory-card-subtitle" id="today-date">March 16, 2025</div>
                <div class="memory-header">
                    <div class="memory-author-pic">
                        <span>BB</span>
                    </div>
                    <div class="memory-meta">
                        <div class="memory-author">Brian Baker</div>
                        <div class="memory-context">From <a href="album-viewer.html?albumId=football-championship">Football Championship</a> album ‚Ä¢ March 16, 2025</div>
                    </div>
                </div>
                <div class="memory-content">
                    <p>The winning moment of our championship game. Still can't believe we pulled it off! Looking back at this moment reminds me of all the hard work our team put in throughout the season...</p>
                </div>
                <img src="/api/placeholder/800/500" alt="Championship Game" class="memory-image">
                <div class="memory-actions">
                    <div class="memory-action liked">‚ù§Ô∏è Like (49)</div>
                    <div class="memory-action">üì• Download</div>
                    <div class="memory-action">‚ÜóÔ∏è Share</div>
                </div>
            </div>

            <div class="memory-card">
                <div class="memory-header">
                    <div class="memory-author-pic">
                        <span>JS</span>
                    </div>
                    <div class="memory-meta">
                        <div class="memory-author">Jane Smith</div>
                        <div class="memory-context">From <a href="album-viewer.html?albumId=senior-trip">Senior Trip</a> album ‚Ä¢ March 15, 2025</div>
                    </div>
                </div>
                <div class="memory-content">
                    <p>Senior trip to Blue Lake State Park! One of my favorite memories from our last year together. We spent the whole weekend hiking, swimming, and telling stories around the campfire...</p>
                </div>
                <img src="/api/placeholder/800/500" alt="Senior Trip" class="memory-image">
                <div class="memory-actions">
                    <div class="memory-action">‚ù§Ô∏è Like (24)</div>
                    <div class="memory-action">üì• Download</div>
                    <div class="memory-action">‚ÜóÔ∏è Share</div>
                </div>
            </div>

            <div class="memory-card">
                <div class="memory-header">
                    <div class="memory-author-pic">
                        <span>AA</span>
                    </div>
                    <div class="memory-meta">
                        <div class="memory-author">Ashley Adams</div>
                        <div class="memory-context">From <a href="album-viewer.html?albumId=school-play">School Play</a> album ‚Ä¢ March 14, 2025</div>
                    </div>
                </div>
                <div class="memory-content">
                    <p>Throwback to our senior play! So many late nights rehearsing, but it was all worth it. I still remember how nervous we all were backstage before the curtains opened...</p>
                </div>
                <img src="/api/placeholder/800/500" alt="School Play" class="memory-image">
                <div class="memory-actions">
                    <div class="memory-action">‚ù§Ô∏è Like (32)</div>
                    <div class="memory-action">üì• Download</div>
                    <div class="memory-action">‚ÜóÔ∏è Share</div>
                </div>
            </div>
        </div>
    </main>
    
    <div class="add-memory-btn" id="addMemoryBtn" title="Add new memory">+</div>
    
    <script>
        // Environment configuration
        const config = {
            isDevelopment: window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1',
            api: {
                baseUrl: window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' 
                    ? 'http://localhost:3001/api' 
                    : '/api',
                uploadsPath: window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
                    ? 'http://localhost:3001/uploads' 
                    : '/uploads'
            }
        };

        // Utility function for API calls
        async function apiCall(endpoint, options = {}) {
            try {
                const url = `${config.api.baseUrl}${endpoint}`;
                const response = await fetch(url, options);
                
                if (!response.ok) {
                    throw new Error(`API call failed: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('API call error:', error);
                return null;
            }
        }

        // Format date helper
        function formatDate(dateString) {
            if (!dateString) return '';
            
            try {
                const date = new Date(dateString);
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                return date.toLocaleDateString(undefined, options);
            } catch (error) {
                console.error('Date formatting error:', error);
                return dateString;
            }
        }

        // Get initials from name
        function getInitials(name) {
            if (!name) return '';
            
            try {
                return name.split(' ')
                    .map(part => part[0])
                    .join('')
                    .toUpperCase();
            } catch (error) {
                console.error('Error getting initials:', error);
                return name.substring(0, 2).toUpperCase();
            }
        }

        // Truncate text to specified length with ellipsis
        function truncateText(text, maxLength) {
            if (!text || text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }

        document.addEventListener('DOMContentLoaded', function() {
            const memoryFeed = document.getElementById('memoryFeed');
            const addMemoryBtn = document.getElementById('addMemoryBtn');
            const todayDateEl = document.getElementById('today-date');
            
            // Set today's date
            if (todayDateEl) {
                const today = new Date();
                todayDateEl.textContent = formatDate(today);
            }
            
            // Load featured memories
            async function loadFeaturedMemories() {
                try {
                    // For demonstration, we'll use the hard-coded memories
                    // In a real implementation, you would fetch from an API
                    
                    const featuredPhotos = await apiCall('/photos?featured=true&limit=3');
                    
                    if (featuredPhotos && featuredPhotos.length > 0) {
                        // Clear existing content and replace with dynamically loaded content
                        memoryFeed.innerHTML = '';
                        
                        // Process the first photo as Feature of the Day
                        if (featuredPhotos[0]) {
                            const featuredCard = createFeaturedMemoryCard(featuredPhotos[0]);
                            if (memoryFeed && featuredCard) {
                                memoryFeed.appendChild(featuredCard);
                            }
                        }
                        
                        // Process remaining photos as regular memories
                        featuredPhotos.slice(1).forEach(photo => {
                            // Create and append memory card
                            try {
                                const memoryCard = createMemoryCard(photo);
                                if (memoryFeed && memoryCard) {
                                    memoryFeed.appendChild(memoryCard);
                                }
                            } catch (error) {
                                console.error('Error creating memory card:', error);
                            }
                        });
                    }
                } catch (error) {
                    console.error('Error loading featured memories:', error);
                }
            }
            
            // Create featured memory card element
            function createFeaturedMemoryCard(photo) {
                if (!photo) return null;
                
                const card = document.createElement('div');
                card.className = 'memory-card';
                
                // Get photo URL or use placeholder
                const photoUrl = photo.filename 
                    ? `${config.api.uploadsPath}/${photo.filename}` 
                    : `/api/placeholder/800/500?text=${encodeURIComponent(photo.title || 'Featured Photo')}`;
                
                // Get album info if available
                const albumHtml = photo.albumName 
                    ? `From <a href="album-viewer.html?albumId=${photo.albumId}">${photo.albumName}</a> album ‚Ä¢ `
                    : '';
                
                // Truncate description to 150 chars
                const description = truncateText(photo.description || 'No description available.', 150);
                
                // Create card HTML with Featured title
                card.innerHTML = `
                    <div class="memory-card-title">Featured Memory of the Day</div>
                    <div class="memory-card-subtitle">${formatDate(new Date())}</div>
                    <div class="memory-header">
                        <div class="memory-author-pic">
                            <span>${getInitials(photo.uploadedBy || 'User')}</span>
                        </div>
                        <div class="memory-meta">
                            <div class="memory-author">${photo.uploadedBy || 'Anonymous'}</div>
                            <div class="memory-context">${albumHtml}${formatDate(photo.uploadDate)}</div>
                        </div>
                    </div>
                    <div class="memory-content">
                        <p>${description}</p>
                    </div>
                    <img src="${photoUrl}" alt="${photo.title || 'Photo'}" class="memory-image">
                    <div class="memory-actions">
                        <div class="memory-action ${photo.isLiked ? 'liked' : ''}">‚ù§Ô∏è Like (${photo.likes || 0})</div>
                        <div class="memory-action">üì• Download</div>
                        <div class="memory-action">‚ÜóÔ∏è Share</div>
                    </div>
                `;
                
                // Add click handler to navigate to photo viewer
                card.querySelector('.memory-image').addEventListener('click', function() {
                    window.location.href = `photos-section.html`;
                });
                
                return card;
            }
            
            // Create regular memory card element
            function createMemoryCard(photo) {
                if (!photo) return null;
                
                const card = document.createElement('div');
                card.className = 'memory-card';
                
                // Get photo URL or use placeholder
                const photoUrl = photo.filename 
                    ? `${config.api.uploadsPath}/${photo.filename}` 
                    : `/api/placeholder/800/500?text=${encodeURIComponent(photo.title || 'Photo')}`;
                
                // Get album info if available
                const albumHtml = photo.albumName 
                    ? `From <a href="album-viewer.html?albumId=${photo.albumId}">${photo.albumName}</a> album ‚Ä¢ `
                    : '';
                
                // Truncate description to 150 chars
                const description = truncateText(photo.description || 'No description available.', 150);
                
                // Create card HTML
                card.innerHTML = `
                    <div class="memory-header">
                        <div class="memory-author-pic">
                            <span>${getInitials(photo.uploadedBy || 'User')}</span>
                        </div>
                        <div class="memory-meta">
                            <div class="memory-author">${photo.uploadedBy || 'Anonymous'}</div>
                            <div class="memory-context">${albumHtml}${formatDate(photo.uploadDate)}</div>
                        </div>
                    </div>
                    <div class="memory-content">
                        <p>${description}</p>
                    </div>
                    <img src="${photoUrl}" alt="${photo.title || 'Photo'}" class="memory-image">
                    <div class="memory-actions">
                        <div class="memory-action ${photo.isLiked ? 'liked' : ''}">‚ù§Ô∏è Like (${photo.likes || 0})</div>
                        <div class="memory-action">üì• Download</div>
                        <div class="memory-action">‚ÜóÔ∏è Share</div>
                    </div>
                `;
                
                // Add click handler to navigate to photo viewer
                card.querySelector('.memory-image').addEventListener('click', function() {
                    window.location.href = `photos-section.html`;
                });
                
                return card;
            }
            
            // Add memory button click handler
            if (addMemoryBtn) {
                addMemoryBtn.addEventListener('click', function() {
                    // In a real implementation, this would open a modal to add a new memory
                    window.location.href = 'photos-section.html';
                });
            }
            
            // Load memories on page load
            // Commenting out for now - would be used with real API
            // loadFeaturedMemories();
        });
    </script>
</body>
</html>